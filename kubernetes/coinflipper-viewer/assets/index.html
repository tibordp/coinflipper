<!DOCTYPE html>
<html>

<head>
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro|Roboto+Mono&display=swap" rel="stylesheet">
  <meta name="viewport" content="initial-scale=1.0, width=device-width">
  <style>
    * {
      box-sizing: border-box;
    }

    html {
      font-size: 16px;
    }

    body {
      background-color: #f4f4f4;
      color: #222;
      padding: 1.5rem 1rem;
      margin: 0;
      font-family: 'Source Sans Pro', sans-serif;
      font-size: 1rem;
      line-height: 1.6;
    }

    img {
      width: 40px;
      height: auto;
      display: block;
      margin: 0 auto;
    }

    section {
      display: block;
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem;
    }

    p,
    h1 {
      text-align: center;
    }

    h1 {
      font-size: 1.75rem;
      margin: 1rem 0;
    }

    p {
      font-size: 1rem;
      margin: 0.75rem 0;
    }

    a {
      color: #0066cc;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    pre {
      color: #eee;
      background-color: #222;
      padding: 1rem;
      border-radius: 10px;
      margin: 1.5rem auto;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      width: fit-content;
      max-width: calc(100vw - 2rem);
      font-size: 0.875rem;
      overflow-x: auto;
      font-family: 'Roboto Mono', monospace;
      line-height: 1.5;
    }

    span.heredoc {
      color: lightblue;
    }

    span.comment {
      color: lightgreen;
    }

    pre.error {
      color: #e66;
    }

    /* Tablet breakpoint */
    @media (min-width: 600px) {
      html {
        font-size: 17px;
      }

      body {
        padding: 2rem 1.5rem;
      }

      h1 {
        font-size: 2rem;
      }

      p {
        font-size: 1.0625rem;
      }

      pre {
        font-size: 0.9375rem;
        padding: 1.25rem;
      }

      img {
        width: 100px;
      }
    }

    /* Desktop breakpoint */
    @media (min-width: 1024px) {
      html {
        font-size: 18px;
      }

      body {
        padding: 2.5rem 2rem;
      }

      section {
        padding: 1.5rem;
      }

      h1 {
        font-size: 2.5rem;
      }

      p {
        font-size: 1.125rem;
      }

      pre {
        font-size: 1rem;
        padding: 1.5rem;
      }

      img {
        width: 120px;
      }
    }

    /* Large desktop - cap the font scaling */
    @media (min-width: 1920px) {
      html {
        font-size: 20px;
      }

      section {
        max-width: 900px;
      }
    }
  </style>
  <title>Coin Flipper Viewer</title>
</head>

<body>
  <pre id="status"></pre>
  <section>
    <h1>What is this?</h1>
    <p>This is <a href="https://www.github.com/tibordp/coinflipper">Coin Flipper</a>, a distributed coin flipping
      that shows how probable it is for a fair coin to land on the same side <i>n</i> times in a row.
    </p>
    <p>Want to help and appear on the list above?</p>
  </section>
  <pre><span class="comment"># On your PC/Mac or on your Raspberry Pi</span>
docker run tibordp/coinflipper:latest \
   flipper coinflipper.ojdip.net</pre>
  <section>
    <p>Or do you have a huge k8s cluster at your disposal?</p>
  </section>
  <pre>kubectl apply -f - &lt;&lt;EOF<span class="heredoc">
apiVersion: apps/v1
kind: Deployment
metadata:
  name: coinflipper-flipper
spec:
  selector:
    matchLabels:
      app: coinflipper-flipper
  replicas: 1337
  template:
    metadata:
      labels:
        app: coinflipper-flipper
    spec:
      containers:
      - image: tibordp/coinflipper:latest
        imagePullPolicy: Always
        name: coinflipper-flipper
        command: ["/coinflipper"]
        args:
        - flipper
        - coinflipper.ojdip.net
        resources:
          limits:
            memory: "16Mi"
            cpu: "1000m"
</span>EOF</pre>
  <section>
    <p><a href="https://www.github.com/tibordp/coinflipper"><img src="./github.png"></a></p>
  </section>
  </footer>
  <script>
    const setStatusText = (text, className) => {
      const statusDisplay = document.querySelector('#status');
      const bodyNode = document.createTextNode(text);
      statusDisplay.className = className;
      if (statusDisplay.firstChild) {
        statusDisplay.replaceChild(bodyNode, statusDisplay.firstChild);
      } else {
        statusDisplay.appendChild(bodyNode);
      }
    };
    function loadStatus() {
      fetch("/status.txt")
        .then(resp => resp.text())
        .then(body => {
          setStatusText(body, "ok");
          window.setTimeout(loadStatus, 2000);
        })
        .catch(() => {
          setStatusText("Failed to load", "error");
          window.setTimeout(loadStatus, 2000);
        })
    }
    loadStatus();
  </script>
</body>
